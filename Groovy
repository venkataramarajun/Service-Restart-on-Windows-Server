@Library('shared-library') _  // If you're using a shared library for snakeyaml

pipeline {
    agent {
        node {
           label 'docker-build-aws'
        }
    }
    environment {
        JENKINS_TOKEN = credentials("pavani_jenkins_api_token")
    }
    stages {
        stage('Read YAML') {
            steps {
                script {
                    def filenames = getFileNames("User_Inputs/RestartRDS")
                    echo "YAML files found: ${filenames}"

                    filenames.each { yamlFilePath ->

                        def result = extractSchedule(yamlFilePath)
                        def database_name = result.db_name
                        def schedule = result.schedule

                        echo "Database name: ${database_name}, Schedule: ${schedule}"
                        echo JENKINS_TOKEN_USR
                        echo JENKINS_TOKEN_PSW

                        createJob(schedule, "GHSSelfServicePlatform/AWS-RDS-Restart", "${database_name}-restart-schedule", JENKINS_TOKEN_USR, JENKINS_TOKEN_PSW)
                    }
                }
            }
        }
    }
}
